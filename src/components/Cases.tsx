"use client";

import { useState } from "react";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";

interface CaseStudy {
  id: string;
  category: string;
  title: string;
  description: string;
  fullContent: {
    task: string;
    solution: string | string[];
    result: string;
  };
}

export function Cases() {
  const [selectedCase, setSelectedCase] = useState<CaseStudy | null>(null);
  const [filter, setFilter] = useState("Консалтинг");

  const cases: CaseStudy[] = [
    {
      id: "sound-dealer",
      category: "Консалтинг",
      title: "Sound Dealer (e-commerce)",
      description:
        "Провели полный операционный аудит и «упаковали» e-commerce бизнес: от карты процессов и регламентов до внедрения CRM и построения документооборота.",
      fullContent: {
        task: "Провести полный операционный аудит и «оцифровку» бизнеса, чтобы сделать его 100% прозрачным и управляемым для владельца.",
        solution: [
          "Провели полный операционный аудит: интервью с руководителями отделов продаж, маркетинга, логистики, бухгалтерии, а также линейными сотрудниками",
          "Описали бизнес-процессы «As-Is» (как есть) и разработали «To-Be» (как должно быть)",
          "Переработали ключевые скрипты продаж и регламенты",
          "Внедрили «под ключ» CRM Bitrix24 и настроили воронки",
          "Автоматизировали документооборот и управление логистической цепочкой",
          "Настроили прозрачную маркетинговую и финансовую отчетность",
        ],
        result:
          "Владелец получил 100% прозрачный, управляемый и «упакованный» бизнес, где все процессы (от скриптов до логистики) описаны, регламентированы и оцифрованы в CRM.",
      },
    },
    {
      id: "bg-logistic",
      category: "Консалтинг",
      title: "BG Logistic (Логистика)",
      description:
        "Провели полный AI-аудит: от 100+ звонков и IT-систем до 7 зон автоматизации с расчетом ROI.",
      fullContent: {
        task: "Крупная логистическая компания теряла заявки, а менеджеры не «дожимали» клиентов.",
        solution: [
          "Провели аудит процессов «As-Is»: от склада до клиентской поддержки",
          "Проанализировали 100+ звонков и зафиксировали типовые возражения",
          "Провели анализ IT-инфраструктуры, чтобы найти точки для интеграции",
          "Разработали новые скрипты продаж и регламенты для менеджеров",
          "Определили 7 зон, где AI сократит издержки и повысит конверсию",
          "Сформировали пошаговый план внедрения AI, начиная с точек с наивысшим ROI",
        ],
        result:
          "Руководство получило четкую карту AI-автоматизации. Рутина снята с команды без расширения штата, процессы готовы к внедрению AI.",
      },
    },
    {
      id: "aluf",
      category: "Консалтинг",
      title: "АЛУФ (IT-интегратор)",
      description:
        "Построили «под ключ» B2B-отдел продаж: от анализа клиентов до продуктовой матрицы, внедренной в Bitrix24.",
      fullContent: {
        task: "Провести «пересборку» компании: от анализа B2B-клиентов до внедрения IT-инструментов для управления сложными продажами.",
        solution: [
          "Анализ: Провели аудит и глубокий анализ ключевых клиентов и вендоров, чтобы понять, кому и что продавать",
          "Система (Продажи): С нуля построили процесс продаж с KPI и внедрили его «под ключ» в Bitrix24",
          "Система (Продукты): Сформировали IT-продуктовую матрицу, собрали проектные предложения и внедрили базу знаний по продуктам в Bitrix24",
        ],
        result:
          "Клиент получил полную «оцифровку» и готовую к масштабированию бизнес-систему. Вместо хаоса — управляемый B2B-отдел продаж с чёткими KPI и продуктовой матрицей в CRM.",
      },
    },
    {
      id: "edtech",
      category: "Консалтинг",
      title: "Enterprise EdTech (Kodland, Eduson)",
      description:
        "Перестроили sales-системы для Enterprise EdTech. Подняли конверсию с 8% до 14% и внедрили AI-автоматизацию.",
      fullContent: {
        task: "Оптимизировать Системы продаж в быстрорастущих EdTech-компаниях, чтобы системно повысить конверсию и сократить цикл сделки.",
        solution: [
          "Провели аудит и системный ре-дизайн CJM, скриптов и CRM-воронок",
          "Внедрили AI-автоматизацию в отделы продаж (команды 15+ чел.), что привело к сокращению цикла сделки",
          "Перестроили процессы и KPI отдела выпускников (Kodland) → рост конверсии с 8% до 14%",
          "Разработали и внедрили системную стратегию upsell → рост среднего чека +12%",
        ],
        result:
          "Вместо хаотичного роста — управляемая Система продаж. Рост ключевых финансовых метрик (конверсия, средний чек) за счет пересборки процессов и внедрения AI-инструментов.",
      },
    },
    {
      id: "ai-events",
      category: "AI-Агенты",
      title: "AI-агент для Ивентов",
      description:
        "Создали AI-агента, который находит конференции, регистрирует менеджеров и контролирует отчеты, повышая конверсию из ивентов в заявки.",
      fullContent: {
        task: "Превратить посещения ивентов в измеримый поток заявок и снизить затраты на ручной контроль менеджеров.",
        solution: [
          "Настроили еженедельный «умный» поиск бизнес-конференций по заданным критериям",
          "Реализовали автоматическую регистрацию на ивенты через Telegram-бота по одному клику менеджера",
          "Внедрили трехэтапную систему уведомлений: показ доступных ивентов → напоминание о посещении → запрос отчета после мероприятия",
          "AI-агент «читает» отчеты менеджеров, извлекает ключевые данные и вносит их в CRM",
          "Полностью автоматизировали весь бизнес-процесс, связав все шаги в единую систему",
          "Срок внедрения: 2 недели",
        ],
        result:
          "Рост конверсии из посещенных ивентов в заявки: +25–30%. Экономия времени на ручной поиск и обработку отчетов: с 3 часов в неделю до 5 минут.",
      },
    },
    {
      id: "ai-ved",
      category: "AI-Агенты",
      title: "«AI-юрист» для ВЭД",
      description:
        "Разработали «AI-юриста», который за секунды генерирует полный отчет по импорту, исключая риск дорогостоящих ошибок на таможне.",
      fullContent: {
        task: "Автоматизировать сбор нормативных данных для ВЭД, чтобы убрать «человеческий фактор» и исключить риск штрафов или задержек груза из-за неверной документации.",
        solution: [
          "Создали систему, в которую менеджер вводит название товара и страну",
          "Запускается сеть из 6 AI-агентов, каждый из которых отвечает за свою область: проверка сертификации, расчет пошлин, ограничения, требования к маркировке «Честный знак»",
          "Система собирает все данные воедино и проверяет их актуальность",
          "Автоматическая генерация готового PDF-отчета с корпоративным дизайном для клиента",
          "Срок внедрения: 3 недели",
        ],
        result:
          "Ускорение подготовки нормативной справки с 2 дней до 20 минут. Снижение ошибок в документации: >95%, что напрямую влияет на скорость таможенного оформления и исключает финансовые потери.",
      },
    },
    {
      id: "ai-tender",
      category: "AI-Агенты",
      title: "AI-парсер для Тендеров",
      description:
        "AI-агент получает Excel-заявку, сам находит лучшие цены у поставщиков и возвращает готовый Excel, напрямую снижая цену закупки.",
      fullContent: {
        task: "Стабильно находить лучшую цену закупки и радикально сократить ручной труд тендерного отдела за счет автоматизации поиска предложений поставщиков.",
        solution: [
          "Менеджер загружает в Telegram-бота Excel-файл с позициями для закупки",
          "AI-агент инициирует «умный» поиск: находит профильные площадки и собирает цены/условия по каждой позиции",
          "Система автоматически приводит цены к единому виду, сравнивает их и выбирает оптимального поставщика по заданным критериям (цена, регион, MOQ, сроки)",
          "Выход: менеджер получает готовый итоговый Excel-файл с лучшим предложением по каждой позиции",
          "Срок внедрения: 2 недели",
        ],
        result:
          "Прямое снижение цен закупки в тендерах: ~7–10% за счет более широкого охвата. Экономия времени (ФОТ) отдела закупки: ~50–60%.",
      },
    },
    {
      id: "ai-engineer",
      category: "AI-Агенты",
      title: "AI-помощник для Инженера",
      description:
        "Создали Telegram-бота, который «знает» все ГОСТы и СНиПы. Снижает стоимость проектных работ за счет экономии времени инженеров.",
      fullContent: {
        task: "Снизить стоимость проектных часов, создав AI-помощника, который экономит время инженеров на поиск нормативов и лишнюю координацию.",
        solution: [
          "Создали «умного» Telegram-бота, обученного на всей базе знаний компании: проектные данные, инструкции, ГОСТы и СНиПы",
          "Бот понимает текстовые и голосовые сообщения, может «читать» файлы (PDF, txt) и работать с фото",
          "Реализовали AI-координатора: бот помогает ставить задачи, интегрирован с общими календарями и системой управления проектами",
          "Инженер может мгновенно получить нужный норматив или статус по задаче, не отрываясь от работы",
          "Срок внедрения: 3 недели",
        ],
        result:
          "Ускорение проектных операций (поиск данных, сверка): с 3 часов до 10 минут. Экономия времени высококвалифицированных инженеров на координацию и коммуникации: ~25–30%.",
      },
    },
    {
      id: "ai-smeta",
      category: "AI-Агенты",
      title: "AI-анализатор Смет",
      description:
        "Внедрили AI-агента, который обрабатывает сметы, сверяет их с каталогом и готовит КП. Позволяет обрабатывать на 30% больше заказов той же командой.",
      fullContent: {
        task: "Увеличить пропускную способность отдела продаж (больше КП = больше выручки) за счет автоматизации сверки клиентских смет, без расширения штата.",
        solution: [
          "Создали AI-агента, который обрабатывает файлы смет (Excel, PDF)",
          "Агент анализирует каждую позицию, ищет совпадения в каталоге, подбирает аналоги, если точного совпадения нет",
          "Автоматически генерирует готовое коммерческое предложение на основе анализа",
          "Срок внедрения: 2 недели",
        ],
        result:
          "Увеличение пропускной способности отдела в 1,5 - 2 раза. Время на ручную обработку одной сметы: ускорилось в среднем в 2-2.5 раза. Снижение ошибок в подборе аналогов на ~70%.",
      },
    },
    {
      id: "ai-b2b-catalog",
      category: "AI-Агенты",
      title: "AI-агент для B2B-каталога",
      description:
        "Создали умного бота для каталога на 6000+ товаров. Ускоряет цикл сделки за счет мгновенной подготовки КП.",
      fullContent: {
        task: "Сократить цикл сделки за счет ускорения работы менеджеров с каталогом на 6000+ позиций и мгновенной подготовки КП.",
        solution: [
          "Разработали умного Telegram-бота, интегрированного с базой данных",
          "Внедрили «умный поиск»: бот понимает запросы на естественном языке и сам находит нужные артикулы",
          "Научили бота помогать формировать коммерческие предложения по запросу сотрудника",
          "Срок внедрения: 2 недели",
        ],
        result:
          "Ускорение цикла сделки: время на подготовку КП сократилось с 4 часов до 1 часа. Снижение ошибок в подборе артикулов и рисков возврата более чем в 2 раза. Высвобождено ~30–40% времени менеджеров, которое раньше уходило на рутинный поиск.",
      },
    },
    {
      id: "ai-aframe",
      category: "AI-Агенты",
      title: "Бот-бронирования A-frame",
      description:
        "Разработали Telegram-бота-администратора. Приносит +15% броней в нерабочее время и экономит ФОТ на ручных операциях.",
      fullContent: {
        task: "Прекратить терять клиентов в нерабочее время и снизить ФОТ на рутинных ответах о свободных датах и ценах.",
        solution: [
          "Разработали Telegram-бота, который работает как полноценный администратор 24/7",
          "Реализовали полный цикл: просмотр каталога домов, проверка свободных дат, бронирование, сбор отзывов",
          "Автоматизировали отправку подтверждений и напоминаний клиентам",
          "Срок внедрения: 2 недели",
        ],
        result:
          "Рост конверсии в бронирование в нерабочее время с нуля до 30% (бот «ловит» клиентов 24/7). Снижение нагрузки на администратора (ручные операции) на 40-50%. 100% бронирований автоматически попадают в систему учета без ручного переноса данных.",
      },
    },
    {
      id: "ai-alice",
      category: "Корп. Разработка",
      title: "Платформа «AI в Яндекс.Алисе»",
      description:
        "Разработали платформу, где клиент загружает свою базу знаний, а Алиса отвечает на вопросы, снижая нагрузку на поддержку.",
      fullContent: {
        task: "Снизить стоимость поддержки клиентов за счет создания интерактивного канала 24/7, который автоматически отвечает на типовые вопросы.",
        solution: [
          "Разработали платформу с удобной админ-панелью",
          "Клиент может сам загружать свои документы (инструкции, таблицы, PDF), и система «обучается» на них",
          "Создали и настроили навык для Яндекс.Алисы, который по QR-коду активирует общение с «умным» помощником",
          "Срок внедрения: 3 недели",
        ],
        result:
          "Снижение стоимости поддержки: AI-агент закрывает до 25% типовых вопросов без участия человека. Рост вовлеченности пользователей (на стенде): +15–20%. Обеспечен мгновенный доступ 24/7 к базе знаний в интерактивном формате.",
      },
    },
    {
      id: "liniya-ii",
      category: "Корп. Разработка",
      title: "«Линия ИИ: Бухгалтерия»",
      description:
        "Выступили тех. партнёром. Разработали AI-модуль для автоматизации бухгалтерии с соблюдением 152-ФЗ.",
      fullContent: {
        task: "Выступить техническим партнёром для крупного инвестора и создать AI-модуль для автоматизации бухгалтерии с соблюдением 152-ФЗ.",
        solution:
          "Разработали архитектуру с нуля, построили масштабируемые пайплайны обработки данных (распознавание, извлечение, верификация) и внедрили систему контроля качества.",
        result:
          "Создана отказоустойчивая система, готовая к высоким нагрузкам и полностью соответствующая требованиям законодательства.",
      },
    },
  ];

  const categories = [
    "Консалтинг",
    "AI-Агенты",
    "Корп. Разработка",
  ];

  const filteredCases = cases.filter((c) => c.category === filter);

  return (
    <section id="keisy" className="section-padding bg-background">
      <div className="container-custom">
        <div className="text-center mb-12 animate-fade-in-up">
          <h2 className="text-3xl md:text-5xl font-bold mb-4 tracking-tight">Наши кейсы</h2>
          <p className="text-lg text-muted-foreground max-w-2xl mx-auto leading-relaxed">
            Реальные проекты, которые мы реализовали для наших клиентов в
            различных отраслях.
          </p>
        </div>

        <div className="flex flex-wrap justify-center gap-3 mb-12">
          {categories.map((cat) => (
            <Button
              key={cat}
              variant={filter === cat ? "default" : "outline"}
              onClick={() => setFilter(cat)}
            >
              {cat}
            </Button>
          ))}
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredCases.map((caseItem, idx) => (
            <Card
              key={caseItem.id}
              className={`p-6 hover:shadow-2xl hover:scale-[1.02] transition-all duration-500 cursor-pointer group bg-gradient-to-br from-background to-background/50 animate-fade-in-up delay-${idx * 100}`}
              onClick={() => setSelectedCase(caseItem)}
            >
              <Badge variant="secondary" className="mb-4 group-hover:bg-primary/10 transition-colors">
                {caseItem.category}
              </Badge>
              <h3 className="text-lg font-semibold mb-3 group-hover:text-primary transition-colors leading-snug">
                {caseItem.title}
              </h3>
              <p className="text-muted-foreground text-sm mb-4 leading-relaxed">
                {caseItem.description}
              </p>
              <div className="flex items-center text-sm font-medium text-primary">
                Читать кейс
                <span className="ml-2 group-hover:translate-x-2 transition-transform duration-300">
                  →
                </span>
              </div>
            </Card>
          ))}
        </div>

        <Dialog
          open={!!selectedCase}
          onOpenChange={() => setSelectedCase(null)}
        >
          <DialogContent className="max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            {selectedCase && (
              <>
                <DialogHeader className="pb-4 border-b border-border flex-shrink-0">
                  <Badge variant="secondary" className="w-fit mb-2 px-3 py-1 bg-gradient-to-r from-primary/10 to-accent/10">
                    {selectedCase.category}
                  </Badge>
                  <DialogTitle className="text-2xl font-bold tracking-tight">
                    {selectedCase.title}
                  </DialogTitle>
                </DialogHeader>

                <div className="space-y-5 mt-4 overflow-y-auto flex-1 pr-2">
                  {/* Задача */}
                  <div className="bg-gradient-to-br from-muted/30 to-muted/10 rounded-lg p-4 border border-border">
                    <h4 className="font-bold text-base mb-2">Задача</h4>
                    <p className="text-sm text-foreground font-medium leading-relaxed">
                      {selectedCase.fullContent.task}
                    </p>
                  </div>

                  {/* Решение */}
                  <div className="bg-gradient-to-br from-background to-muted/5 rounded-lg p-4 border border-border">
                    <h4 className="font-bold text-base mb-3">
                      Что сделали
                    </h4>
                    {Array.isArray(selectedCase.fullContent.solution) ? (
                      <ul className="space-y-2">
                        {selectedCase.fullContent.solution.map((item, idx) => (
                          <li key={idx} className="flex items-start gap-2.5 text-sm text-muted-foreground leading-relaxed">
                            <span className="flex-shrink-0 w-5 h-5 rounded-full bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center mt-0.5">
                              <svg className="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                              </svg>
                            </span>
                            <span className="flex-1">{item}</span>
                          </li>
                        ))}
                      </ul>
                    ) : (
                      <p className="text-sm text-muted-foreground leading-relaxed">
                        {selectedCase.fullContent.solution}
                      </p>
                    )}
                  </div>

                  {/* Результат */}
                  <div className="bg-gradient-to-br from-emerald-500/5 to-emerald-600/5 border-2 border-emerald-600/20 p-4 rounded-lg">
                    <h4 className="font-bold text-base mb-2 bg-gradient-to-r from-emerald-600 to-emerald-700 bg-clip-text text-transparent">
                      Результат
                    </h4>
                    <p className="text-sm text-foreground font-medium leading-relaxed">
                      {selectedCase.fullContent.result}
                    </p>
                  </div>
                </div>
              </>
            )}
          </DialogContent>
        </Dialog>
      </div>
    </section>
  );
}
